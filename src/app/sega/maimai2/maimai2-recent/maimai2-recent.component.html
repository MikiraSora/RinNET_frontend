<h1 class="page-heading">{{'Maimai2.RecentPage.Title'|translate}}</h1>


<div *ngIf="recent" class="record d-flex flex-column">
  <div class="card mt-3" *ngFor="let item of recent | async | paginate: { id: 'server', itemsPerPage: 10, currentPage: currentPage, totalItems: totalElements }; let i = index">
    <div class="card-header px-3 py-2">
      <div class="row">
        <div class="col-6">
          {{item.userPlayDate}}
        </div>
        <div class="col-6 text-end">
          <ng-container *ngIf="item.songInfo" [ngSwitch]="item.level">
            <span *ngSwitchCase="0" class="difficulty-basic badge rounded-pill">
              Basic {{item.songInfo.details[item.level].levelDecimal/10.0|number:'1.1-1'}}
            </span>
            <span *ngSwitchCase="1" class="difficulty-advanced badge rounded-pill">
              Advanced {{item.songInfo.details[item.level].levelDecimal/10.0|number:'1.1-1'}}
            </span>
            <span *ngSwitchCase="2" class="difficulty-expert badge rounded-pill">
              Expert {{item.songInfo.details[item.level].levelDecimal/10.0|number:'1.1-1'}}
            </span>
            <span *ngSwitchCase="3" class="difficulty-master badge rounded-pill">
              Master {{item.songInfo.details[item.level].levelDecimal/10.0|number:'1.1-1'}}
            </span>
            <span *ngSwitchCase="4" class="difficulty-remaster badge rounded-pill">
              Re:Master {{item.songInfo.details[item.level].levelDecimal/10.0|number:'1.1-1'}}
            </span>
          </ng-container>
          <span style="min-width: 4rem">TRACK {{item.trackNo}}</span>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-auto song-jacket-container">
          <img
            class="song-jacket"
            *ngIf="enableImages == true"
            [src]="host + 'assets/mai2/jacket/UI_Jacket_' + getJacketId(item.musicId) + '.webp'"
            (error)="imgError($event)"
            #img alt="">
        </div>
        <div class="col flex-grow-1">
          <h4>{{item.songInfo != null ? item.songInfo.name : 'musicId:' + item.musicId}}</h4>

          <div class="row no-wrap">
            <div class="col-8">
              <span *ngIf="item.isAchieveNewRecord" class="new-record badge rounded-pill tiny-text">NEW RECORD!</span>
              <h1>{{item.achievement/10000.0|number:'1.4-4'}}%
              </h1>
            </div>
            <div class="col-4 d-flex justify-content-end align-items-center">
              <img class="rank-icon" src="{{host}}assets/mai2/common/{{getRankIcon(item)}}.webp">
            </div>
          </div>
          <div class="card bg-secondary-subtle">
            <div class="d-flex justify-content-between align-items-center no-wrap">
              <div class="d-flex flex-row" style="align-items: center;">
                <div class="col ms-1" *ngIf="getIconVisibility(item,0)">
                  <img class="full-height" src="{{host}}assets/mai2/common/{{getComboIcon(item)}}.webp">
                </div>
                <div class="col" *ngIf="getIconVisibility(item,1)">
                  <img class="full-height" src="{{host}}assets/mai2/common/{{getSyncIcon(item)}}.webp">
                </div>
                <div class="col" *ngIf="getIconVisibility(item,1)">
                  <img class="rival-img" src="{{host}}assets/mai2/common/{{getRivalNumber(item)}}.webp">
                </div>
                <div class="col ms-1" *ngIf="getIconVisibility(item,2)">
                  <img class="clear-img" src="{{host}}assets/mai2/common/clear.webp">
                </div>
              </div>

              <div class="d-flex flex-column align-items-end dx-score-container">
                <span class="text-end mx-1">{{item.deluxscore}}/{{item.totalCombo*3}}</span>
                <span class="text-end tiny-text mx-1">{{getDxScoreStar(item)}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer" *ngIf="!isDetailVisible[i]">
      <div class="row justify-content-end">
        <button class="btn btn-primary col-auto" (click)="toggleDetail(i)">{{'Maimai2.RecentPage.Detailed'|translate}}</button>
      </div>
    </div>
    <div class="card m-1 mt-2 mb-2" *ngIf="isDetailVisible[i]">
      <div class="flex-container align-items-start">
        <div class="left-column mt-3 ms-3 me-3">
          <table class="table detail-table table-striped">
            <thead>
            <tr>
              <th style="min-width: 4rem;"></th>
              <th>CRIT.PREF</th>
              <th>PREFECT</th>
              <th>GREAT</th>
              <th>GOOD</th>
              <th>MISS</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>TAP</td>
              <td>{{item.tapCriticalPerfect}}</td>
              <td>{{item.tapPerfect}}</td>
              <td>{{item.tapGreat}}</td>
              <td>{{item.tapGood}}</td>
              <td>{{item.tapMiss}}</td>
            </tr>
            <tr>
              <td>HOLD</td>
              <td>{{item.holdCriticalPerfect}}</td>
              <td>{{item.holdPerfect}}</td>
              <td>{{item.holdGreat}}</td>
              <td>{{item.holdGood}}</td>
              <td>{{item.holdMiss}}</td>
            </tr>
            <tr>
              <td>SLIDE</td>
              <td>{{item.slideCriticalPerfect}}</td>
              <td>{{item.slidePerfect}}</td>
              <td>{{item.slideGreat}}</td>
              <td>{{item.slideGood}}</td>
              <td>{{item.slideMiss}}</td>
            </tr>
            <tr *ngIf="item.isTouch">
              <td>TOUCH</td>
              <td>{{item.touchCriticalPerfect}}</td>
              <td>{{item.touchPerfect}}</td>
              <td>{{item.touchGreat}}</td>
              <td>{{item.touchGood}}</td>
              <td>{{item.touchMiss}}</td>
            </tr>
            <tr>
              <td>BREAK</td>
              <td>{{item.breakCriticalPerfect}}</td>
              <td>{{item.breakPerfect}}</td>
              <td>{{item.breakGreat}}</td>
              <td>{{item.breakGood}}</td>
              <td>{{item.breakMiss}}</td>
            </tr>
            <tr>
              <td></td>
              <td>FAST</td>
              <td>{{item.fastCount}}</td>
              <td>LATE</td>
              <td>{{item.lateCount}}</td>
              <td></td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="m-3 row">
          <div class="col">
            <div class="small mt-2">DXRating</div>
            <div class="dx-rating-container p-1 bg-secondary-subtle mt-1">
              <h4 class="dx-rating-textholder">{{item.afterRating}}<span class="badge rounded-pill tiny-text bg-info">+{{item.afterRating - item.beforeRating}}</span></h4>
            </div>
          </div>
          <div class="col">
            <div class="small mt-2">Combo</div>
            <div class="dx-rating-container p-1 bg-secondary-subtle mt-1">
              <h4 class="dx-rating-textholder">{{item.maxCombo}}/{{item.totalCombo}}</h4>
            </div>
          </div>
          <div class="col" *ngIf="getIconVisibility(item,1)">
            <div class="small mt-2">Sync</div>
            <div class="dx-rating-container p-1 bg-secondary-subtle mt-1">
              <h4 class="dx-rating-textholder">{{item.maxSync}}/{{item.totalSync}}</h4>
            </div>
          </div>
          <div class="col" *ngIf="getIconVisibility(item,1)">
            <div class="small mt-2">2P Player</div>
            <div class="dx-rating-container p-1 bg-secondary-subtle mt-1">
              <h4 class="dx-rating-textholder">{{item.playedUserName1}}</h4>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="pagination">
  <pagination-controls (pageChange)="load($event)" id="server"></pagination-controls>
</div>
